{% extends "base.html" %}

{% block title %}Flights Management - SmallGoods{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/flights_management.css') }}">
{% endblock %}

{% block content %}
<div class="flights-management">
    <div class="header-section">
        <h1>Flights Management</h1>
        <button class="btn btn-primary" id="add-flight-btn">
            <i class="icon-plus"></i> Add New Flight
        </button>
    </div>

    <!-- Competition and Event Selection -->
    <div class="selection-section">
        <div class="selection-controls">
            <div class="form-group">
                <label for="competition-select">Competition:</label>
                <select id="competition-select">
                    <option value="">Select Competition</option>
                    {% for competition in competitions %}
                    <option value="{{ competition.id }}">{{ competition.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="event-select">Event:</label>
                <select id="event-select" disabled>
                    <option value="">Select Event</option>
                </select>
            </div>
            <div class="form-group">
                <button type="button" id="show-all-flights" class="btn btn-secondary">Show All Flights</button>
            </div>
        </div>
    </div>

    <!-- Flights Container -->
    <div class="flights-container" id="flights-container">
        <div class="empty-state" id="empty-state">
            <h3>No Event Selected</h3>
            <p>Please select a competition and event to manage flights, or view all flights below.</p>
        </div>

        <!-- Flights List (will be populated via JavaScript) -->
        <div class="flights-list" id="flights-list" style="display: none;">
            <div class="flights-header">
                <h2>Flight Order Management</h2>
                <p>Drag and drop to reorder flights. Changes are saved automatically.</p>
            </div>
            
            <div class="flights-grid" id="flights-grid">
                <!-- Flight cards will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Flight Athletes Management -->
    <div class="flight-athletes-section" id="flight-athletes-section" style="display: none;">
        <div class="section-header">
            <h2>Flight Athletes</h2>
            <div class="flight-info">
                <span id="current-flight-name">Flight A</span>
                <span id="current-flight-order">Order: 1</span>
            </div>
        </div>

        <div class="athletes-management">
            <div class="available-athletes">
                <h3>Available Athletes</h3>
                <div class="athletes-search">
                    <input type="text" id="available-search" placeholder="Search available athletes...">
                </div>
                <div class="athletes-list" id="available-athletes-list">
                    <!-- Available athletes will be populated here -->
                </div>
            </div>

            <div class="flight-athletes">
                <h3>Athletes in Flight</h3>
                <div class="athletes-list" id="flight-athletes-list">
                    <!-- Flight athletes will be populated here -->
                </div>
            </div>
        </div>

        <div class="attempt-order-section">
            <h3>Attempt Order Management</h3>
            <div class="attempt-controls">
                <button class="btn btn-secondary" id="sort-by-weight">Sort by Weight</button>
                <button class="btn btn-secondary" id="sort-by-name">Sort by Name</button>
                <button class="btn btn-secondary" id="randomize-order">Randomize Order</button>
            </div>
            <div class="attempt-order-list" id="attempt-order-list">
                <!-- Attempt order will be displayed here -->
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Flight Modal -->
<div id="flight-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="flight-modal-title">Add New Flight</h2>
            <span class="close">&times;</span>
        </div>
        <form id="flight-form">
            <div class="form-group">
                <label for="flight_name">Flight Name *</label>
                <input type="text" id="flight_name" name="flight_name" required placeholder="e.g., Flight A, Flight B">
            </div>
            <div class="form-group">
                <label for="flight_event_id">Event *</label>
                <select id="flight_event_id" name="event_id" required>
                    <option value="">Select Event</option>
                </select>
            </div>
            <div class="form-group">
                <label for="flight_order">Order *</label>
                <input type="number" id="flight_order" name="flight_order" required min="1">
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="flight_is_active" name="is_active">
                    Active Flight
                </label>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancel-flight-btn">Cancel</button>
                <button type="submit" class="btn btn-primary" id="save-flight-btn">Save Flight</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Flight Confirmation Modal -->
<div id="delete-flight-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Confirm Delete</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this flight? This will also remove all athletes from this flight.</p>
            <p><strong id="delete-flight-name"></strong></p>
        </div>
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancel-delete-flight-btn">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirm-delete-flight-btn">Delete</button>
        </div>
    </div>
</div>

<a href="{{ url_for('admin.admin_dashboard') }}" class="back-link">‚Üê Back to Admin Dashboard</a>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="{{ url_for('static', filename='js/admin/flights_management.js') }}"></script>
{% endblock %}
